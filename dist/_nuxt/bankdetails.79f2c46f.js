import{_ as F}from"./WelcomeBaseAdmin.b516bbda.js";import{q as O,e as R,r as l,L as z,M as H,f as K,a as o,h as W,b as s,w as Y,i as A,v as S,u as e,A as D,F as G,B as I,j as i,t as g,k as N,l as J,o as u}from"./entry.9a5b8fbf.js";import{g as P}from"./getters.e7c64068.js";import"./ModalBase.2f1919b6.js";import"./vend.d0cdc105.js";const Q={class:"text-left p-3 bg-white rounded-md"},X=["onSubmit"],Z={class:"mt-3"},ee=s("label",{class:"block mb-3 pl-2 font-medium text-lg",for:"bank_name"},"Bank Name:",-1),te={key:0,class:"rounded-md bg-gray-200 mt-1 overflow-y-auto max-h-56"},ae=["onClick"],ne={key:1,class:"mt-1 px-2 text-red-600 font-semibold"},re={class:"mt-3"},se=s("label",{class:"block mb-3 pl-2 font-medium text-lg",for:"account_number"},"Account Number:",-1),le={key:0,class:""},oe=["innerHTML"],ue={class:"mt-3"},ce=s("label",{class:"block mb-3 pl-2 font-medium text-lg",for:"account_name"},"Account Name:",-1),ie={key:0,class:"animate-pulse font-semibold text-yellow-600"},de={key:0},me={class:"text-center p-2 mt-3"},_e=["disabled"],be={key:0,class:"animate-spin h-7 w-7 -mb-2 mr-3 pt-2 border-r-2 border-b-2 border-l-2 border-whtie rounded-full inline-block"},xe={__name:"bankdetails",setup(fe){const L=O(),k=P(),c=R();k.getBanks(),c.getSiteDetails();const t=l({bank_code:"",bank_name:"",account_number:"",account_name:""});t.value.bank_name=c.details.account_bank,t.value.account_number=c.details.account_number,t.value.account_name=c.details.account_name,t.value.track_id=c.details.track_id;let m=l({}),x=l(!1),V=l([]);l(!1);let B=l(!1),_=l(!0),C=l(""),f=l(!1);z(()=>{c.details.account_bank.length>0});const d=H({userphoneerror:!1,userphoneerrormsg:"",useraccterror:!1,useraccterrormsg:""});let b=l(!1);function U(n){t.value.bank_name=n,b.value=!1}function T(){b.value=!0;let n=t.value.bank_name,a=new RegExp(`${n}`,"gi"),p=k.banks.filter(r=>a.test(r.name)==!0);V.value=p}function q(){let n=k.banks.filter(a=>a.name==t.value.bank_name);n.length==0?(B.value=!1,_.value=!1,C.value="Bank does not exist. Choose from the Bank List."):n.length>0&&(B.value=!0,_.value=!0,t.value.bank_code=n[0].code)}function j(){let n=t.value.account_number;var a=/[a-z]+/i;a.test(n)||n.length!=10&&n.length>0?(y.value=!1,d.useraccterror=!0,d.useraccterrormsg="<ul class='text-red-500'><li>Only numeric characters required</li><li>Account Number must be 10 digits</li></ul>"):(d.useraccterror=!1,d.useraccterrormsg="",M())}let h=l(""),y=l(!1),w=l(!1);function M(){let n=k.banks.filter(a=>a.name==t.value.bank_name);if(n.length>0&&t.value.account_number.length>0){y.value=!1,w.value=!0;let a=n[0].code,p={account_number:t.value.account_number,bank_code:a};L.verifyAccount(p).then(r=>{w.value=!1,y.value=!0,h.value=r.status,t.value.account_name=r.account_name})}}const $=K(()=>v.value==!0||!B.value||t.value.account_name.length<=0||t.value.account_number.length<=0||t.value.bank_name.length<=0||d.useraccterror==!0);let v=l(!1);async function E(){x.value=!1,v.value=!0;try{return await c.updateSiteBank(t.value).then(n=>{v.value=!1,m.value=n,x.value=!0,f.value=!1,c.getSiteDetails()})}catch(n){v.value=!1,f.value=!0,m.value=n}}return(n,a)=>{const p=F;return u(),o("div",null,[W(p),s("div",Q,[s("form",{onSubmit:Y(E,["prevent"])},[s("div",Z,[ee,A(s("input",{"onUpdate:modelValue":a[0]||(a[0]=r=>e(t).bank_name=r),onKeyup:T,onChange:M,onFocus:a[1]||(a[1]=r=>{D(b)?b.value=!0:b=!0,D(_)?_.value=!0:_=!0}),onBlur:a[2]||(a[2]=r=>q()),class:"p-3 rounded-md w-full ring-0 bg-gray-200",id:"bank_name",name:"bank_name",type:"text",required:"",placeholder:""},null,544),[[S,e(t).bank_name]]),e(b)?(u(),o("div",te,[(u(!0),o(G,null,I(e(V),r=>(u(),o("p",{onClick:ve=>{U(r.name),q()},class:"p-2 mt-1 cursor-pointer hover:bg-gray-100",key:r.code},g(r.name),9,ae))),128))])):i("",!0),e(_)?i("",!0):(u(),o("p",ne,g(e(C)),1))]),s("div",re,[se,A(s("input",{"onUpdate:modelValue":a[3]||(a[3]=r=>e(t).account_number=r),onKeyup:a[4]||(a[4]=r=>j()),class:"p-3 rounded-md w-full ring-0 bg-gray-200",id:"account_number",name:"account_number",type:"text",required:"",placeholder:""},null,544),[[S,e(t).account_number]]),e(d).useraccterror?(u(),o("div",le,[s("p",{innerHTML:e(d).useraccterrormsg},null,8,oe)])):i("",!0)]),s("div",ue,[ce,A(s("input",{"onUpdate:modelValue":a[5]||(a[5]=r=>e(t).account_name=r),class:"p-3 rounded-md w-full ring-0 bg-gray-200",id:"account_name",name:"account_name",type:"text",required:"",placeholder:""},null,512),[[S,e(t).account_name]]),e(w)?(u(),o("p",ie,"Verifying...")):i("",!0),e(y)?(u(),o("p",{key:1,class:N(["px-1 text-md font-semibold",{"text-green-600":e(h),"text-red-600":!e(h)}])},g(e(h)?"Account verified successfully":"Account could not be verified. Check the Account details again. You can type the Account name and proceed if you are sure the details are correct."),3)):i("",!0)]),e(x)||e(f)?(u(),o("div",{key:0,class:N([{"bg-green-300/[.6] text-green-800":e(m).status,"bg-red-400/[.40] text-red-900":!e(m).status||e(f)},"p-3 mt-3 text-left rounded-md"])},[s("p",null,g(e(m).message),1),e(f)?(u(),o("p",de,g(e(m)),1)):i("",!0)],2)):i("",!0),s("div",me,[s("button",{type:"submit",disabled:e($),class:N([{"opacity-50":e($)},"p-2 bg-[#0f8B8D] w-1/2 text-white rounded-md font-bold text-lg hover:bg-[#0a5556]"])},[e(v)?(u(),o("span",be)):i("",!0),J(" Update Site ")],10,_e)])],40,X)])])}}};export{xe as default};
