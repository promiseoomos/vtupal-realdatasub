import{_ as Q}from"./WelcomeBase.d566a554.js";import{v as P,a as U,_ as X}from"./ActiveBoardBase.7e2fb3ce.js";import{q as Y,r as u,s as Z,R as ee,S as E,f as te,a as n,h as V,b as l,w as ae,i as x,K as le,u as e,F as se,B as ne,v as T,j as i,t as d,l as R,A as K,k as D,o as r}from"./entry.9a5b8fbf.js";import{f as re}from"./useFormatDigits.0d52ca80.js";import{_ as oe}from"./getAmount.a622716e.js";import{v as ue}from"./vend.d0cdc105.js";import"./ModalBase.2f1919b6.js";import"./useStrings.2b5df556.js";const ie={class:"rounded-md bg-gray-100 p-2"},de={class:"flex flex-wrap justify-between mt-4 px-2"},ce={class:"rounded-md bg-white p-2 mt-3"},pe=["onSubmit"],me={class:"mt-3"},ve=l("label",{for:"subject",class:"block mb-3 font-medium text-lg pl-1"},"Choose Bouquet Plan",-1),fe=l("option",{value:"null"},"--Select Bouquet Plan--",-1),be=["value"],_e={key:0,class:"mt-3"},ye=l("label",{for:"subject",class:"block mb-3 font-medium text-lg pl-1"},"IUC Number",-1),he={key:1,class:"mt-3"},ge=l("label",{for:"subject",class:"block mb-3 font-medium text-lg pl-1"},"Smartcard Number",-1),ke={key:2,class:"animate-pulse font-semibold text-yellow-600"},xe={key:3,class:"mt-1 text-red-600"},we={key:4,class:"mt-1 text-red-600"},Ie={key:5,class:"mt-1 text-red-600"},Se={key:6,class:"mt-1 text-green-600"},Ve={key:7,class:"mt-1 text-green-600"},Te={key:8,class:"mt-1 text-red-600"},Be={class:"mt-3"},Ce=l("label",{for:"sender",class:"block mb-3 font-medium text-lg pl-1"},"Amount ",-1),je={class:"mt-3"},qe=l("label",{for:"sender",class:"block mb-3 font-medium text-lg pl-1"},"Phone (optional)",-1),Ne={key:9,class:"mt-1 text-red-600"},Oe={key:10,class:"mt-1 text-red-600"},De={key:0},Me={key:1},$e={class:"text-center p-2 mt-3"},Ae=["disabled"],Ge={key:0,class:"animate-spin h-7 w-7 -mb-2 mr-3 pt-2 border-r-2 border-b-2 border-l-2 border-whtie rounded-full inline-block"},Pe={key:12,class:"text-center p-2 mt-3"},Ue=["disabled"],Qe={__name:"index",setup(Ee){const w=Y(),b=ue();let B=u({}),C=u({}),j=u({}),q=u({}),I=u(!1),m=u(!1),M=u(""),g=u(""),N=u(1);b.getBillerCat();const t=u({mobile_number:"",planId:null,phone:"",type:"cable",country:"NG",amount:"",face_amount:0,userId:w.details.track_id,transactionType:"tvcable-payment",paymentChannel:"arise_data",charge:.5,cable:null,cableId:"",planpackage:"",recipient:"",currency:w.details.currency});let _=u([]);const S=Z();ee(()=>{if(S.query.type){S.query.type.length>0&&(M.value=S.query.type);{let o=b.services.data.find(p=>p.service_name=="cable").service_suffix,s=b.services.data.find(p=>p.service_name=="cable").percentage.find(p=>p.user_type==w.details.type);if(N.value=s==null?0:s.value/100,Object.keys(b.cableServices).length>0){let p=M.value+""+o,f=b.cableServices[p];f.length>0&&(_.value=f.filter(a=>a.plan_type!="SME"))}}}});function F(){if(_.value.length>0){let o=_.value.filter(a=>a.id==t.value.planId)[0].cable,s=Number(_.value.filter(a=>a.id==t.value.planId)[0].plan_amount),p=_.value.filter(a=>a.id==t.value.planId)[0].planpackage;t.value.cableId=b.services.data.find(a=>a.service_name=="cable").services.find(a=>a.name==o).id,t.value.cable=o,t.value.face_amount=s,t.value.amount=Math.round(s+s*N.value);let f=re(t.value.amount);g.value=w.details.currency=="NGN"?`\u20A6${f}`:`$${f}`,t.value.planpackage=p,m.value=!1}}let c=u({}),y=u(!1),v=u({});async function L(){y.value=!0,c.value={};try{await b.validateBill(t.value).then(o=>{c.value=o,y.value=!1})}catch(o){c.value=o,y.value=!1}}let h=u(5),k=u(!1),O=u();const z=()=>{m.value=!0,O.value=setInterval(H,1e3)},W=()=>{clearInterval(O.value),m.value=!1,h.value=5,k.value=!1};E(h,()=>{h.value<=0&&(clearInterval(O.value),k.value=!0,$())});const H=()=>{h.value--};async function $(){m.value=!0;try{await b.createBill(t.value).then(o=>{m.value=!1,v.value=o})}catch(o){v.value=o,m.value=!1}finally{h.value=5,k.value=!1}}const A=te(()=>!!(m.value||y.value||c.value.status=="error"&&!I.value||t.value.bouquet=="null"));E(()=>S.query.type,o=>{t.value.recipient="",t.value.phone="",t.value.country="",t.value.amount="",t.value.planId=null,c.value={},v.value={},m.value=!1,y.value=!1});function G(){B.value=P(t.value.recipient),C.value=U(t.value.recipient,10),j.value=P(t.value.phone),q.value=U(t.value.phone,11)}return(o,s)=>{const p=Q,f=X;return r(),n("div",null,[V(p),l("div",ie,[l("div",de,[V(f,{class:"w-1/4 h-32",icon:"gotv.jpg",text:"GOTV",link:"dashboard-tvpayment",query:{type:"GOTV"}}),V(f,{class:"w-1/4 h-32",icon:"dstv.jpg",text:"DSTV",link:"dashboard-tvpayment",query:{type:"DSTV"}}),V(f,{class:"w-1/4 h-32",icon:"startimes.jpg",text:"STARTIME",link:"dashboard-tvpayment",query:{type:"STARTIME"}})]),l("div",ce,[l("form",{onSubmit:ae($,["prevent"])},[l("div",me,[ve,x(l("select",{class:"p-3 rounded-md w-full ring-0 border border-gray-200","onUpdate:modelValue":s[0]||(s[0]=a=>e(t).planId=a),onChange:F},[fe,(r(!0),n(se,null,ne(e(_),(a,J)=>(r(),n("option",{key:J,value:a.cableplan_id},d(a.package)+" "+d(e(oe)(Number(a.plan_amount),e(N))),9,be))),128))],544),[[le,e(t).planId]])]),o.$route.query.type=="GOTV"?(r(),n("div",_e,[ye,x(l("input",{type:"text",onKeyup:G,"onUpdate:modelValue":s[1]||(s[1]=a=>e(t).recipient=a),id:"subject",class:"p-3 rounded-md w-full ring-0 border border-gray-200"},null,544),[[T,e(t).recipient]])])):i("",!0),o.$route.query.type!="GOTV"?(r(),n("div",he,[ge,x(l("input",{type:"text",onKeyup:L,"onUpdate:modelValue":s[2]||(s[2]=a=>e(t).recipient=a),id:"subject",class:"p-3 rounded-md w-full ring-0 border border-gray-200"},null,544),[[T,e(t).recipient]])])):i("",!0),e(y)?(r(),n("p",ke,"Validating...")):i("",!0),e(c).status=="error"?(r(),n("p",xe,d(e(c).message),1)):i("",!0),e(B).status?i("",!0):(r(),n("p",we,d(e(B).message),1)),e(C).status?i("",!0):(r(),n("p",Ie,d(e(C).message),1)),e(c).status=="success"?(r(),n("p",Se,d(e(c).message),1)):i("",!0),e(c).status=="success"?(r(),n("p",Ve,"Customer name :"+d(e(c).data.name),1)):i("",!0),e(c).status=="error"?(r(),n("p",Te,[R("Could not validate customer. "),l("span",{onClick:s[3]||(s[3]=a=>K(I)?I.value=!0:I=!0),class:"underline cursor-pointer text-blue-400"},"Proceed anyways.")])):i("",!0),l("div",Be,[Ce,x(l("input",{type:"text",disabled:!0,"onUpdate:modelValue":s[4]||(s[4]=a=>K(g)?g.value=a:g=a),id:"sender",class:"p-3 rounded-md w-full ring-0 border border-gray-200",placeholder:"3000"},null,512),[[T,e(g)]])]),l("div",je,[qe,x(l("input",{type:"text","onUpdate:modelValue":s[5]||(s[5]=a=>e(t).phone=a),onKeyup:G,id:"sender",class:"p-3 rounded-md w-full ring-0 border border-gray-200",placeholder:"09020801526"},null,544),[[T,e(t).phone]])]),e(j).status?i("",!0):(r(),n("div",Ne,d(e(j).message),1)),e(q).status?i("",!0):(r(),n("div",Oe,d(e(q).message),1)),e(v)?(r(),n("div",{key:11,class:D(["rounded-md p-3 mt-3",{"text-red-600 bg-red-600/[.2]":e(v).status=="error","text-green-600 bg-green-600/[.2]":e(v).status=="success"}])},[e(v).status=="error"?(r(),n("p",De,d(e(v).message),1)):i("",!0),e(v).status=="success"?(r(),n("p",Me,d(e(v).message),1)):i("",!0)],2)):i("",!0),l("div",$e,[l("button",{disabled:e(A),class:D([{"opacity-50":e(A)},"p-3 px-10 bg-[#0f8B8D] w-full lg:w-1/2 text-white rounded-md font-bold text-md hover:bg-[#0a5556]"]),onClick:z},[e(m)?(r(),n("span",Ge)):i("",!0),R(" Make "+d(o.$route.query.type)+" Payment",1)],10,Ae)]),e(m)?(r(),n("div",Pe,[l("button",{disabled:e(k),onClick:W,class:D([{"opacity-50":e(k)},"p-2 bg-black w-full lg:w-1/2 text-white rounded-md font-bold text-lg"])}," Cancel ("+d(e(h))+") ",11,Ue)])):i("",!0)],40,pe)])])])}}};export{Qe as default};
